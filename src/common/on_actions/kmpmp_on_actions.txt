# Root = Country
on_country_formed = {
    on_actions = {
        kmpmp_new_formables
    }
}

# Root = Country
on_monthly_pulse_country = {
    on_actions = {
        kmpmp_update_nation_buffs_action
        # buff_nation_effect_for_formables
        # buff_nation_effect_for_unification
        player_boost_effect_state_unincorporated_education_access

        kmpmp_fix_sick_man_of_europe
    }
}

# Root = Diplomatic Play
# scope:actor = Initiator country
# scope:target = Target country
on_war_end = {
    on_actions = {
        kmpmp_remove_war_modifiers
    }
}

kmpmp_fix_sick_man_of_europe = {
    effect = {
        if = {
            limit = {
                c:TUR ?= this
                has_modifier = kmpmp_sick_man_of_europe_restored_fame
                NOT = {
                    has_variable = sick_man_complete
                }
            }
            set_variable = sick_man_complete
            remove_modifier = outmoded_bureaucracy
            remove_modifier = cizye_tax
        }
    }
}

kmpmp_update_nation_buffs_action = {
    effect = {
        kmpmp_update_nation_buffs = yes
    }
}

buff_nation_effect_for_unification = {
    effect = {
        if = {
            limit = {
                exists = c:ITA
                owner = c:ITA
            }
            if = {
                limit = {
                    NOT = {
                        has_modifier = kmpmp_buff_medium_nation
                    }
                }
                add_modifier = {
                    name = kmpmp_buff_medium_nation
                }
            }
            if = {
                limit = {
                    has_modifier = kmpmp_buff_small_nation
                }
                remove_modifier = kmpmp_buff_small_nation
            }
        }

        if = {
            limit = {
                exists = c:SCA
                owner = c:SCA
            }
            if = {
                limit = {
                    NOT = {
                        has_modifier = kmpmp_buff_medium_nation
                    }
                }
                add_modifier = {
                    name = kmpmp_buff_medium_nation
                }
            }
            if = {
                limit = {
                    has_modifier = kmpmp_buff_small_nation
                }
                remove_modifier = kmpmp_buff_small_nation
            }
        }
    }
}

buff_nation_effect_for_formables = {
    effect = {
        if = {
            limit = {
                exists = c:IBE
                owner = c:IBE
            }
            if = {
                limit = {
                    NOT = {
                        has_modifier = kmpmp_buff_medium_nation
                    }
                }
                add_modifier = {
                    name = kmpmp_buff_medium_nation
                }
            }
            if = {
                limit = {
                    has_modifier = kmpmp_buff_small_nation
                }
                remove_modifier = kmpmp_buff_small_nation
            }
        }
        if = {
            limit = {
                exists = c:UNL
                owner = c:UNL
            }
            if = {
                limit = {
                    NOT = {
                        has_modifier = kmpmp_buff_small_nation
                    }
                }
                add_modifier = {
                    name = kmpmp_buff_small_nation
                }
            }
        }
    }
}

player_boost_effect_state_unincorporated_education_access = {
    effect = {
        if = {
            limit = {
                has_modifier = kmpmp_player_boost_imperialism_oversea_empire
            }
            every_scope_state = {
                limit = {
                    is_incorporated = no
                }
                add_modifier = {
                    name = kmpmp_player_boost_imperialism_oversea_empire_state_unincorporated_education_access
                    days = 30
                }
            }
        }
    }
}

kmpmp_remove_war_modifiers = {
    effect = {
        if = {
            limit = {
                OR = {
                    scope:actor = {
                        has_modifier = kmpmp_retake_whats_rightfully_german
                        save_temporary_scope_as = country_with_modifier_kmpmp_retake_whats_rightfully_german
                    }
                    scope:target = {
                        has_modifier = kmpmp_retake_whats_rightfully_german
                        save_temporary_scope_as = country_with_modifier_kmpmp_retake_whats_rightfully_german
                    }
                }
                OR = {
                    c:FRA ?= scope:actor
                    c:FRA ?= scope:target
                }
            }
            scope:country_with_modifier_kmpmp_retake_whats_rightfully_german = {
                remove_modifier = kmpmp_retake_whats_rightfully_german
            }
        }
    }
}

kmpmp_new_formables = {
    effect = {
        if = {
            limit = {
                c:P01 = ROOT
            }
            trigger_event = formation.21
        }
    }
}
