# Root = Country
# scope:target = the country the wargoal was enforced against
# scope:diplomatic_play = the relevant diplomatic play
# scope:wargoal_impact = the impact of the wargoal enforced
on_wargoal_enforced = {
	effect = {
		if = {
			limit = {
				OR = {
					AND = {
						has_journal_entry = je_anti_lobby_demand
						var:anti_lobby_demand_target ?= scope:target
					}
					AND = {
						has_journal_entry = je_pro_lobby_demand
						var:pro_lobby_demand_target ?= scope:target
					}
				}
			}
			set_variable = { name = enforced_wargoal_on_enemy days = 90 }
		}
		set_variable = {
            name = recently_won_war
            days = 1825
            value = yes
        }

		### Narrative war-end events
        if = { # Paris Commune - Commune victory event
        	limit = {
        		c:PRC ?= root
        		NOT = {
        			exists = c:FRA
        		}
        	}
        	c:PRC = {
				set_immune_to_revolutions = no
				change_tag = FRA
				every_scope_state = {
					limit = {
						state_region = {
							is_homeland = cu:french
						}
					}
					set_state_type = incorporated
				}
        	}
        }
		if = { # Paris Commune - France victory event
			limit = {
				c:FRA ?= root
				NOT = {
					exists = c:PRC
				}
			}
			if = {
				limit = {
					c:FRA = {
						is_immune_to_revolutions = yes
					}
				}
				set_immune_to_revolutions = no
			}
		}
        if = { # Ragamuffin War - Piratini victory event
        	limit = {
        		owner = {
	        		c:PNI ?= this
	        		has_variable = ragamuffin_nation_var
	        		NOT = { has_variable = won_ragamuffin_war_var }
					owns_entire_state_region = STATE_RIO_GRANDE_DO_SUL
					owns_entire_state_region = STATE_SANTA_CATARINA
				}
        	}
        	owner = {
        		set_variable = won_ragamuffin_war_var
        		trigger_event = { id = brazilian_minors.1 days = 0 popup = yes }
        	}
        }
        if = { # Ragamuffin War - Brazilian victory over Grao-Para
        	limit = {
        		owner = {
        			game_date < 1850.1.1 # Just in case.
        			NOT = {
        				has_variable = cabanagem_defeat_var
        				exists = c:PRA
        			}
	        		c:BRZ ?= this
					owns_entire_state_region = STATE_PARA
					any_scope_state = { state_region = s:STATE_AMAZONAS }
				}
        	}
        	owner = {
        		set_variable = cabanagem_defeat_var
        		trigger_event = { id = brazilian_minors.2 days = 0 popup = yes }
        	}
        }
        if = { # Ragamuffin War - Brazilian victory over Piratini
        	limit = {
        		owner = {
        			game_date < 1850.1.1 # Just in case.
        			NOT = {
        				has_variable = ragamuffin_defeat_var
        				exists = c:PNI
        			}
	        		c:BRZ ?= this
					owns_entire_state_region = STATE_RIO_GRANDE_DO_SUL
				}
        	}
        	owner = {
        		set_variable = ragamuffin_defeat_var
        		trigger_event = { id = brazilian_minors.3 days = 0 popup = yes }
        	}
        }

		if = { # recently crushed a secession
			limit = {
				scope:diplomatic_play ?= {
					is_diplomatic_play_type = dp_secession
				}
			}
			ROOT ?= {
				set_variable = {
					name = crushed_secession
					days = 90
				}
			}
		}

		if = { # Ottoman recently crushed a secession
			limit = {
				AND = {
					c:TUR ?= this
					has_journal_entry = je_great_eastern_crisis
					scope:diplomatic_play = {
						is_diplomatic_play_type = dp_secession
					}
				}
			}
			ROOT ?= {
				set_variable = {
					name = ottoman_crushed_secession
					days = 365
				}
			}
		}

		if = { # Balkan Wars - Ottoman Empire loses
			limit = {
				ROOT = {
					NOT = {
						has_variable = lost_balkan_wars
					}
					scope:target ?= {
						c:TUR ?= this
					}
					scope:diplomatic_play = {
						is_diplomatic_play_type = dp_balkan_war
					}
				}
			}
			scope:target ?= {
				trigger_event = { id = balkan_wars.13 popup = yes }
				set_variable = {
					name = lost_balkan_wars
					days = 30
				}
			}
			scope:diplomatic_play = {
				if = {
					limit = {
						NOT = {
							any_scope_initiator_ally = {
								country_rank >= rank_value:great_power
							}
						}
					}
					every_scope_play_involved = {
						limit = {
							has_journal_entry = je_the_balkan_league
						}
						set_variable = balkan_league_fought_alone_var
					}
				}
			}
		}

		if = { # Balkan Wars - BL loses
			limit = {
				ROOT = {
					scope:target ?= {
						has_journal_entry = je_the_balkan_league
					}
					scope:diplomatic_play = {
						is_diplomatic_play_type = dp_balkan_war
					}
				}
			}
			scope:target ?= {
				set_variable = {
					name = lost_balkan_wars
					days = 30
				}
			}
		}
        if = { # Persia - Loss of Herat
        	limit = {
        		owner = {
	        		c:PER ?= this
					NOT = {
						any_scope_state = {
							state_region = s:STATE_HERAT
						}
					}
					has_modifier = modifier_herat_inspiration
				}
        	}
        	owner = {
        		remove_modifier = modifier_herat_inspiration
        	}
        }
        if = { # India - Capture of the Koh-i-Noor
        	limit = {
        		owner = {
        			NOT = {
        				has_variable = punjab_captured
        			}
	        		c:BIC ?= this
					is_subject = yes
					country_or_subject_owns_entire_state_region = STATE_PUNJAB
				}
        	}
        	owner = {
        		set_variable = punjab_captured
        		trigger_event = { id = india_events.3 days = 7 popup = yes }
        	}
        }

		### Earning Recognition functions
		# kmpmp: removed wargoal enforced at major or higher (due to it prob always beeing abused)
		# if = {
		# 	limit = {
		# 		scope:target ?= {
		# 			has_journal_entry = je_earn_recognition
		# 		}
		# 	}
		# 	scope:target ?= {
		# 		set_variable = { 
		# 			name = temp_wargoal_impact 
		# 			value = {
		# 				value = scope:wargoal_impact 
		# 				multiply = -4
		# 			}
		# 		}
		# 		if = {
		# 			limit = {
		# 				has_variable = temp_wargoal_impact
		# 			}
		# 			je:je_earn_recognition ?= {
		# 				add_progress = { value = owner.var:temp_wargoal_impact name = earn_recognition_progress_bar }
		# 			}
		# 		}
		# 	}
		# }
		# if = {
		# 	limit = {
		# 		owner = {
		# 			has_journal_entry = je_earn_recognition
		# 		}
		# 		scope:target ?= {
		# 			OR = {
		# 				is_country_type = recognized
		# 				is_country_type = colonial
		# 			}
		# 			country_rank >= rank_value:major_power
		# 		}
		# 	}
		# 	owner = {
		# 		set_variable = { 
		# 			name = temp_wargoal_impact 
		# 			value = {
		# 				value = scope:wargoal_impact 
		# 				multiply = 4
		# 			}
		# 		}
		# 		if = {
		# 			limit = {
		# 				has_variable = temp_wargoal_impact
		# 			}
		# 			je:je_earn_recognition ?= {
		# 				add_progress = { value = owner.var:temp_wargoal_impact name = earn_recognition_progress_bar }
		# 			}
		# 		}
		# 	}
		# }

		if = { # Enforcing Trialist Manifesto
			limit = {
				c:AUS ?= owner
				scope:target ?= {
					c:HUN ?= this
					NOT = {
						has_variable = forced_trialist_manifesto
					}
				}
				scope:diplomatic_play = {
					is_diplomatic_play_type = dp_enforce_trialist_manifesto
				}
			}
			owner = {
				trigger_event = { id = austria_trialism.3 days = 1 popup = yes }
			}
			scope:target = {
				set_variable = { name = forced_trialist_manifesto years = 1 }
			}
		}

		### Austrian Neo-Absolutism JE
		if = {
			limit = {
				scope:target ?= {
					has_journal_entry = je_austrian_neo_absolutism
				}
			}
			scope:target ?= {
				set_variable = {
					name = temp_wargoal_impact
					value = {
						value = scope:wargoal_impact
						multiply = 4
					}
				}
				if = {
					limit = {
						has_variable = temp_wargoal_impact
					}
					je:je_austrian_neo_absolutism ?= {
						add_progress = { value = owner.var:temp_wargoal_impact name = austrian_neo_absolutism_constitutional_pressure_progress_bar }
					}
				}
			}
		}
		if = {
			limit = {
				owner = {
					has_journal_entry = je_austrian_neo_absolutism
				}
				scope:target ?= {
					OR = {
						is_country_type = recognized
						is_country_type = colonial
					}
					country_rank >= rank_value:great_power
				}
			}
			owner = {
				set_variable = {
					name = temp_wargoal_impact
					value = {
						value = scope:wargoal_impact
						multiply = -4
					}
				}
				if = {
					limit = {
						has_variable = temp_wargoal_impact
					}
					je:je_austrian_neo_absolutism ?= {
						add_progress = { value = owner.var:temp_wargoal_impact name = austrian_neo_absolutism_constitutional_pressure_progress_bar }
					}
				}
			}
		}
		if = {
			limit = {
				owner ?= {
					has_journal_entry = je_austrian_neo_absolutism
				}
				scope:target ?= {
					c:PRU ?= this
				}
			}
			owner = {
				set_variable = has_enforced_wargoal_on_prussia_var
			}
		}
		if = {
			limit = {
				owner ?= {
					has_journal_entry = je_austrian_neo_absolutism
				}
				scope:target ?= {
					c:GER ?= this
				}
			}
			owner = {
				set_variable = has_enforced_wargoal_on_germany_var
			}
		}
	}
}